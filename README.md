# ğŸ¤– LLM æ™ºèƒ½å®¢æœç³»ç»Ÿ

åŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„ä¼ä¸šçº§æ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œé›†æˆ RAG æ£€ç´¢å¢å¼ºç”Ÿæˆã€å¤šè½®å¯¹è¯è®°å¿†ã€æ„å›¾è¯†åˆ«ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯å±‚                              â”‚
â”‚          Vue3 å‰ç«¯  â”€â”€  WebSocket  â”€â”€  REST API             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API ç½‘å…³å±‚ (FastAPI)                    â”‚
â”‚        è®¤è¯ä¸­é—´ä»¶  â”‚  é™æµä¸­é—´ä»¶  â”‚  æ—¥å¿—ä¸­é—´ä»¶              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è¯æœåŠ¡   â”‚ â”‚  çŸ¥è¯†åº“æœåŠ¡ â”‚ â”‚  ç”¨æˆ·æœåŠ¡   â”‚ â”‚  è¯„ä¼°æœåŠ¡ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒå¼•æ“å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LLMå®¢æˆ·ç«¯ â”‚  â”‚ RAGæ£€ç´¢  â”‚  â”‚ æ„å›¾è¯†åˆ« â”‚  â”‚ è®°å¿†ç®¡ç† â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å­˜å‚¨å±‚                                 â”‚
â”‚   PostgreSQL    â”‚    Redis    â”‚    ChromaDB    â”‚  æ–‡ä»¶å­˜å‚¨  â”‚
â”‚  (ç”¨æˆ·/å¯¹è¯)    â”‚   (ç¼“å­˜)    â”‚  (å‘é‡æ•°æ®åº“)  â”‚  (æ–‡æ¡£)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| åç«¯æ¡†æ¶ | FastAPI | 0.109+ |
| LLMç¼–æ’ | LangChain | 0.2+ |
| LLMæ¨¡å‹ | OpenAI GPT-4 / Ollama | - |
| å‘é‡æ•°æ®åº“ | ChromaDB | 0.5+ |
| å…³ç³»æ•°æ®åº“ | PostgreSQL | 15+ |
| ç¼“å­˜ | Redis | 7+ |
| å‰ç«¯æ¡†æ¶ | Vue 3 + Vite | - |
| è®¤è¯ | JWT (python-jose) | - |
| å®¹å™¨åŒ– | Docker + Docker Compose | - |
| æµ‹è¯• | Pytest | 7+ |

## ğŸ“ é¡¹ç›®ç»“æ„

```
llm_example/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ main.py                 # FastAPI å…¥å£
â”‚   â”œâ”€â”€ config.py               # å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ api/                    # API è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py         # å¯¹è¯æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py         # è®¤è¯æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge.py    # çŸ¥è¯†åº“æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ admin.py        # ç®¡ç†åå°æ¥å£
â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”‚       â”œâ”€â”€ auth.py         # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚       â””â”€â”€ rate_limit.py   # é™æµä¸­é—´ä»¶
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.py       # LLM å®¢æˆ·ç«¯ (OpenAI/Ollama)
â”‚   â”‚   â”‚   â””â”€â”€ prompt_manager.py # Prompt æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ rag/
â”‚   â”‚   â”‚   â”œâ”€â”€ embedder.py     # æ–‡æœ¬å‘é‡åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ retriever.py    # ç›¸ä¼¼åº¦æ£€ç´¢
â”‚   â”‚   â”‚   â””â”€â”€ vector_store.py # ChromaDB ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ memory/
â”‚   â”‚   â”‚   â””â”€â”€ conversation_memory.py # å¯¹è¯ä¸Šä¸‹æ–‡è®°å¿†
â”‚   â”‚   â””â”€â”€ intent/
â”‚   â”‚       â””â”€â”€ classifier.py   # æ„å›¾è¯†åˆ«åˆ†ç±»å™¨
â”‚   â”œâ”€â”€ models/                 # æ•°æ®æ¨¡å‹ (SQLAlchemy)
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ conversation.py
â”‚   â”‚   â””â”€â”€ knowledge.py
â”‚   â”œâ”€â”€ services/               # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ chat_service.py     # å¯¹è¯ç¼–æ’æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ auth_service.py     # ç”¨æˆ·è®¤è¯
â”‚   â”‚   â””â”€â”€ quality_service.py  # è´¨é‡è¯„ä¼°
â”‚   â”œâ”€â”€ db/                     # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â””â”€â”€ utils/                  # å·¥å…·ç±»
â”‚       â”œâ”€â”€ logger.py           # ç»“æ„åŒ–æ—¥å¿—+å®¡è®¡
â”‚       â””â”€â”€ performance.py      # å¤šçº§ç¼“å­˜+æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ frontend/                   # Vue3 å‰ç«¯
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â”œâ”€â”€ nginx.conf              # Nginx ç”Ÿäº§é…ç½®
â”‚   â”œâ”€â”€ Dockerfile              # å¤šé˜¶æ®µæ„å»º
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ App.vue
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ ChatWindow.vue  # èŠå¤©ä¸»çª—å£
â”‚       â”‚   â”œâ”€â”€ MessageBubble.vue # æ¶ˆæ¯æ°”æ³¡
â”‚       â”‚   â””â”€â”€ KnowledgeAdmin.vue # çŸ¥è¯†åº“ç®¡ç†
â”‚       â”œâ”€â”€ store/
â”‚       â”‚   â””â”€â”€ chat.js         # Pinia çŠ¶æ€ç®¡ç†
â”‚       â””â”€â”€ api/
â”‚           â””â”€â”€ index.js        # API è¯·æ±‚å°è£…
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ conftest.py             # pytest å…¬å…± fixtures
â”‚   â”œâ”€â”€ unit/                   # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_intent_classifier.py
â”‚   â”‚   â”œâ”€â”€ test_conversation_memory.py
â”‚   â”‚   â””â”€â”€ test_chat_service.py
â”‚   â””â”€â”€ integration/            # é›†æˆæµ‹è¯•
â”‚       â””â”€â”€ test_api.py
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ architecture.md         # ç³»ç»Ÿæ¶æ„æ–‡æ¡£
â”‚   â””â”€â”€ api.md                  # å®Œæ•´ API æ¥å£æ–‡æ¡£
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ init_db.py              # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ load_knowledge.py       # çŸ¥è¯†åº“æ‰¹é‡å¯¼å…¥
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ knowledge/              # çŸ¥è¯†åº“æ–‡æ¡£ï¼ˆæ”¾å…¥å¾…å¯¼å…¥æ–‡ä»¶ï¼‰
â”‚   â””â”€â”€ chroma_db/              # å‘é‡æ•°æ®åº“æŒä¹…åŒ–
â”œâ”€â”€ logs/                       # è¿è¡Œæ—¥å¿—ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â””â”€â”€ requirements.txt
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šDocker Compose ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†é¡¹ç›®
git clone git@github.com:DJsummer/Intelligent-Customer-Service.git
cd Intelligent-Customer-Service

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
vi .env   # å¡«å…¥ OPENAI_API_KEY ç­‰å¿…å¡«é¡¹

# 3. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 4. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 5. è®¿é—®ç³»ç»Ÿ
open http://localhost         # å‰ç«¯ç•Œé¢
open http://localhost:8000/docs  # API æ–‡æ¡£
```

### æ–¹å¼äºŒï¼šæœ¬åœ°å¼€å‘æ¨¡å¼

```bash
# ç¯å¢ƒè¦æ±‚ï¼šPython 3.11+ã€Node.js 20+ã€PostgreSQL 15+ã€Redis 7+

# 1. å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env è®¾ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯

# 3. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆåˆ›å»ºè¡¨ + é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼‰
cd backend && python ../scripts/init_db.py

# 4. å¯¼å…¥çŸ¥è¯†åº“æ–‡æ¡£
mkdir -p data/knowledge
# å°† PDF/DOCX/TXT/MD æ–‡æ¡£æ”¾å…¥ data/knowledge/
python scripts/load_knowledge.py --dir data/knowledge

# 5. å¯åŠ¨åç«¯
cd backend
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# 6. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd frontend
npm install && npm run dev
# è®¿é—® http://localhost:5173
```

### é»˜è®¤è´¦å·

| è´¦å· | å¯†ç  | è§’è‰² |
|------|------|------|
| admin | Admin@123456 | ç®¡ç†å‘˜ |

> âš ï¸ é¦–æ¬¡ç™»å½•åè¯·ç«‹å³ä¿®æ”¹å¯†ç 

---

## ğŸ“¡ API æ¥å£æ‘˜è¦

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/auth/register` | ç”¨æˆ·æ³¨å†Œ | âŒ |
| POST | `/auth/login` | ç”¨æˆ·ç™»å½• | âŒ |
| GET  | `/auth/me` | å½“å‰ç”¨æˆ·ä¿¡æ¯ | âœ… |
| POST | `/chat/message` | å‘é€æ¶ˆæ¯ï¼ˆRESTï¼‰ | å¯é€‰ |
| GET  | `/chat/history/{session_id}` | å¯¹è¯å†å² | âœ… |
| POST | `/chat/end/{session_id}` | ç»“æŸä¼šè¯ | âœ… |
| POST | `/chat/feedback` | æ¶ˆæ¯è¯„åˆ† | âœ… |
| WS   | `/ws/chat/{session_id}` | WebSocket æµå¼å¯¹è¯ | âœ… |
| POST | `/knowledge/upload` | ä¸Šä¼ çŸ¥è¯†æ–‡æ¡£ | agent+ |
| GET  | `/knowledge/list` | æ–‡æ¡£åˆ—è¡¨ | agent+ |
| DELETE | `/knowledge/{id}` | åˆ é™¤æ–‡æ¡£ | admin |
| POST | `/knowledge/search` | è¯­ä¹‰æœç´¢ | âœ… |
| GET  | `/admin/stats` | ç³»ç»Ÿç»Ÿè®¡ | admin |
| GET  | `/admin/conversations` | å¯¹è¯åˆ—è¡¨ | admin |
| GET  | `/admin/users` | ç”¨æˆ·åˆ—è¡¨ | admin |
| GET  | `/health` | å¥åº·æ£€æŸ¥ | âŒ |

ğŸ“– å®Œæ•´æ¥å£æ–‡æ¡£è§ [docs/api.md](docs/api.md) æˆ–è®¿é—® `http://localhost:8000/docs`

---

## âš™ï¸ ä¸»è¦ç¯å¢ƒå˜é‡

| å˜é‡ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `OPENAI_API_KEY` | âœ… | - | OpenAI API å¯†é’¥ |
| `LLM_PROVIDER` | âŒ | `openai` | `openai` / `ollama` / `azure` |
| `DATABASE_URL` | âœ… | - | PostgreSQL è¿æ¥ä¸² |
| `REDIS_URL` | âŒ | `redis://localhost:6379/0` | Redis è¿æ¥ä¸² |
| `SECRET_KEY` | âœ… | - | JWT ç­¾åå¯†é’¥ï¼ˆç”Ÿäº§å¿…é¡»ä¿®æ”¹ï¼‰ |
| `OLLAMA_BASE_URL` | âŒ | `http://localhost:11434` | Ollama åœ°å€ï¼ˆæœ¬åœ°æ¨¡å‹ï¼‰ |

---

## ğŸ”‘ æ ¸å¿ƒç‰¹æ€§

- âœ… **å¤šè½®å¯¹è¯** â€” Redis æ»‘åŠ¨çª—å£ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œæ”¯æŒ N è½®è®°å¿†
- âœ… **RAG æ£€ç´¢å¢å¼º** â€” ChromaDB å‘é‡æ£€ç´¢ + å¤šçº§ç¼“å­˜ï¼ˆL1 å†…å­˜ + L2 Redisï¼‰
- âœ… **æ„å›¾è¯†åˆ«** â€” è§„åˆ™ä¼˜å…ˆ + LLM å…œåº•ï¼Œè‡ªåŠ¨è¯†åˆ« 6 ç±»ç”¨æˆ·æ„å›¾
- âœ… **æµå¼è¾“å‡º** â€” WebSocket å®æ—¶ Token æµå¼ä¼ è¾“ï¼Œæ¯«ç§’çº§é¦–å­—èŠ‚å“åº”
- âœ… **å¤šæ¨¡å‹æ”¯æŒ** â€” OpenAI / Ollamaï¼ˆæœ¬åœ°éƒ¨ç½²ï¼‰/ Azure OpenAI æ— ç¼åˆ‡æ¢
- âœ… **JWT è®¤è¯** â€” Access Tokenï¼ˆ1hï¼‰+ Refresh Tokenï¼ˆ7dï¼‰ï¼Œç™»å½•é”å®šä¿æŠ¤
- âœ… **æ€§èƒ½ä¼˜åŒ–** â€” Embedding æ‰¹é‡ç¼“å­˜ï¼ˆTTL 24hï¼‰ã€çƒ­ç‚¹çŸ¥è¯†é¢„çƒ­ã€DB è¿æ¥æ± 
- âœ… **ç»“æ„åŒ–æ—¥å¿—** â€” request_id ä¼ æ’­ã€LLM è°ƒç”¨è¿½è¸ªã€JSON Lines å®¡è®¡æ—¥å¿—
- âœ… **è´¨é‡ç›‘æ§** â€” P95 å»¶è¿Ÿã€RAG å‘½ä¸­ç‡ã€æ„å›¾åˆ†å¸ƒã€ç”¨æˆ·æ»¡æ„åº¦æŒ‡æ ‡
- âœ… **å®¹å™¨åŒ–éƒ¨ç½²** â€” å¤šé˜¶æ®µ Dockerfileã€Nginx åå‘ä»£ç†ã€Docker Compose ç¼–æ’

---

## ğŸ§ª è¿è¡Œæµ‹è¯•

```bash
cd backend
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-asyncio httpx

# è¿è¡Œå…¨éƒ¨æµ‹è¯•
pytest ../tests/ -v

# ä»…è¿è¡Œå•å…ƒæµ‹è¯•
pytest ../tests/unit/ -v

# ä»…è¿è¡Œé›†æˆæµ‹è¯•
pytest ../tests/integration/ -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest ../tests/ --cov=. --cov-report=html
```

---

## ğŸ“„ License

MIT

