# ðŸ¤– LLM æ™ºèƒ½å®¢æœç³»ç»Ÿ

åŸºäºŽå¤§è¯­è¨€æ¨¡åž‹ï¼ˆLLMï¼‰çš„ä¼ä¸šçº§æ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œé›†æˆ RAG æ£€ç´¢å¢žå¼ºç”Ÿæˆã€å¤šè½®å¯¹è¯è®°å¿†ã€æ„å›¾è¯†åˆ«ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ðŸ—ï¸ ç³»ç»Ÿæž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®¢æˆ·ç«¯å±‚                              â”‚
â”‚          Vue3 å‰ç«¯  â”€â”€  WebSocket  â”€â”€  REST API             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API ç½‘å…³å±‚ (FastAPI)                    â”‚
â”‚        è®¤è¯ä¸­é—´ä»¶  â”‚  é™æµä¸­é—´ä»¶  â”‚  æ—¥å¿—ä¸­é—´ä»¶              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è¯æœåŠ¡   â”‚ â”‚  çŸ¥è¯†åº“æœåŠ¡ â”‚ â”‚  ç”¨æˆ·æœåŠ¡   â”‚ â”‚  è¯„ä¼°æœåŠ¡ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒå¼•æ“Žå±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LLMå®¢æˆ·ç«¯ â”‚  â”‚ RAGæ£€ç´¢  â”‚  â”‚ æ„å›¾è¯†åˆ« â”‚  â”‚ è®°å¿†ç®¡ç† â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å­˜å‚¨å±‚                                 â”‚
â”‚   PostgreSQL    â”‚    Redis    â”‚    ChromaDB    â”‚  æ–‡ä»¶å­˜å‚¨  â”‚
â”‚  (ç”¨æˆ·/å¯¹è¯)    â”‚   (ç¼“å­˜)    â”‚  (å‘é‡æ•°æ®åº“)  â”‚  (æ–‡æ¡£)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ› ï¸ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| åŽç«¯æ¡†æž¶ | FastAPI | 0.109+ |
| LLMç¼–æŽ’ | LangChain | 0.2+ |
| LLMæ¨¡åž‹ | OpenAI GPT-4 / Ollama | - |
| å‘é‡æ•°æ®åº“ | ChromaDB | 0.5+ |
| å…³ç³»æ•°æ®åº“ | PostgreSQL | 15+ |
| ç¼“å­˜ | Redis | 7+ |
| å‰ç«¯æ¡†æž¶ | Vue 3 + Vite | - |
| è®¤è¯ | JWT (python-jose) | - |
| å®¹å™¨åŒ– | Docker + Docker Compose | - |
| æµ‹è¯• | Pytest | 7+ |

## ðŸ“ é¡¹ç›®ç»“æž„

```
llm_example/
â”œâ”€â”€ backend/                    # åŽç«¯æœåŠ¡
â”‚   â”œâ”€â”€ main.py                 # FastAPI å…¥å£
â”‚   â”œâ”€â”€ config.py               # å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ api/                    # API è·¯ç”±å±‚
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py         # å¯¹è¯æŽ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py         # è®¤è¯æŽ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge.py    # çŸ¥è¯†åº“æŽ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ admin.py        # ç®¡ç†åŽå°æŽ¥å£
â”‚   â”‚   â””â”€â”€ middleware/
â”‚   â”‚       â”œâ”€â”€ auth.py         # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚       â””â”€â”€ rate_limit.py   # é™æµä¸­é—´ä»¶
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”‚   â”œâ”€â”€ client.py       # LLM å®¢æˆ·ç«¯ (OpenAI/Ollama)
â”‚   â”‚   â”‚   â””â”€â”€ prompt_manager.py # Prompt æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ rag/
â”‚   â”‚   â”‚   â”œâ”€â”€ embedder.py     # æ–‡æœ¬å‘é‡åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ retriever.py    # ç›¸ä¼¼åº¦æ£€ç´¢
â”‚   â”‚   â”‚   â””â”€â”€ vector_store.py # ChromaDB ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ memory/
â”‚   â”‚   â”‚   â””â”€â”€ conversation_memory.py # å¯¹è¯ä¸Šä¸‹æ–‡è®°å¿†
â”‚   â”‚   â””â”€â”€ intent/
â”‚   â”‚       â””â”€â”€ classifier.py   # æ„å›¾è¯†åˆ«åˆ†ç±»å™¨
â”‚   â”œâ”€â”€ models/                 # æ•°æ®æ¨¡åž‹ (SQLAlchemy)
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ conversation.py
â”‚   â”‚   â””â”€â”€ knowledge.py
â”‚   â”œâ”€â”€ services/               # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ chat_service.py     # å¯¹è¯ç¼–æŽ’æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ auth_service.py     # ç”¨æˆ·è®¤è¯
â”‚   â”‚   â””â”€â”€ quality_service.py  # è´¨é‡è¯„ä¼°
â”‚   â”œâ”€â”€ db/                     # æ•°æ®åº“è¿žæŽ¥
â”‚   â”‚   â””â”€â”€ database.py
â”‚   â””â”€â”€ utils/                  # å·¥å…·ç±»
â”‚       â”œâ”€â”€ logger.py           # ç»“æž„åŒ–æ—¥å¿—+å®¡è®¡
â”‚       â””â”€â”€ performance.py      # å¤šçº§ç¼“å­˜+æ€§èƒ½ä¼˜åŒ–
â”œâ”€â”€ frontend/                   # Vue3 å‰ç«¯
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â”œâ”€â”€ nginx.conf              # Nginx ç”Ÿäº§é…ç½®
â”‚   â”œâ”€â”€ Dockerfile              # å¤šé˜¶æ®µæž„å»º
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ App.vue
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ ChatWindow.vue  # èŠå¤©ä¸»çª—å£
â”‚       â”‚   â”œâ”€â”€ MessageBubble.vue # æ¶ˆæ¯æ°”æ³¡
â”‚       â”‚   â””â”€â”€ KnowledgeAdmin.vue # çŸ¥è¯†åº“ç®¡ç†
â”‚       â”œâ”€â”€ store/
â”‚       â”‚   â””â”€â”€ chat.js         # Pinia çŠ¶æ€ç®¡ç†
â”‚       â””â”€â”€ api/
â”‚           â””â”€â”€ index.js        # API è¯·æ±‚å°è£…
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ conftest.py             # pytest å…¬å…± fixtures
â”‚   â”œâ”€â”€ unit/                   # å•å…ƒæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_intent_classifier.py
â”‚   â”‚   â”œâ”€â”€ test_conversation_memory.py
â”‚   â”‚   â””â”€â”€ test_chat_service.py
â”‚   â””â”€â”€ integration/            # é›†æˆæµ‹è¯•
â”‚       â””â”€â”€ test_api.py
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ architecture.md         # ç³»ç»Ÿæž¶æž„æ–‡æ¡£
â”‚   â””â”€â”€ api.md                  # å®Œæ•´ API æŽ¥å£æ–‡æ¡£
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ init_db.py              # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ load_knowledge.py       # çŸ¥è¯†åº“æ‰¹é‡å¯¼å…¥
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ knowledge/              # çŸ¥è¯†åº“æ–‡æ¡£ï¼ˆæ”¾å…¥å¾…å¯¼å…¥æ–‡ä»¶ï¼‰
â”‚   â””â”€â”€ chroma_db/              # å‘é‡æ•°æ®åº“æŒä¹…åŒ–
â”œâ”€â”€ logs/                       # è¿è¡Œæ—¥å¿—ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â””â”€â”€ requirements.txt
```

## ðŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šOllama + Docker Composeï¼ˆå…è´¹æŽ¨èï¼‰

ä½¿ç”¨æœ¬åœ° Ollama æ¨¡åž‹ï¼Œå®Œå…¨å…è´¹ï¼Œæ— éœ€ OpenAI API Keyã€‚

```bash
# 1. å®‰è£… Ollama
curl -fsSL https://ollama.com/install.sh | sh

# 2. æ‹‰å–æ¨¡åž‹ï¼ˆèŠå¤©æ¨¡åž‹ ~4.7GB + åµŒå…¥æ¨¡åž‹ ~274MBï¼‰
ollama pull qwen2.5:7b
ollama pull nomic-embed-text

# 3. é…ç½® Ollama ç›‘å¬æ‰€æœ‰æŽ¥å£ï¼ˆè®© Docker å®¹å™¨å¯è®¿é—®ï¼‰
sudo mkdir -p /etc/systemd/system/ollama.service.d
echo -e '[Service]\nEnvironment="OLLAMA_HOST=0.0.0.0"' | sudo tee /etc/systemd/system/ollama.service.d/override.conf
sudo systemctl daemon-reload && sudo systemctl restart ollama

# 4. å…‹éš†é¡¹ç›®
git clone git@github.com:DJsummer/Intelligent-Customer-Service.git
cd Intelligent-Customer-Service

# 5. é…ç½®çŽ¯å¢ƒå˜é‡ï¼ˆ.env.example é»˜è®¤å·²æ˜¯ Ollama é…ç½®ï¼‰
cp .env.example .env
# åªéœ€ä¿®æ”¹æ•°æ®åº“å¯†ç ç­‰å¿…å¡«é¡¹ï¼ŒLLM ç›¸å…³æ— éœ€ä¿®æ”¹

# 6. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# 7. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# 8. è®¿é—®ç³»ç»Ÿ
# å‰ç«¯ç•Œé¢:    http://localhost
# API æ–‡æ¡£:   http://localhost:8000/docs
```

### æ–¹å¼äºŒï¼šOpenAI API + Docker Compose

```bash
# 1. å…‹éš†é¡¹ç›®
git clone git@github.com:DJsummer/Intelligent-Customer-Service.git
cd Intelligent-Customer-Service

# 2. é…ç½®çŽ¯å¢ƒå˜é‡
cp .env.example .env
vi .env   # ä¿®æ”¹ä»¥ä¸‹å…³é”®é¡¹ï¼š
          # LLM_PROVIDER=openai
          # OPENAI_API_KEY=sk-your-key
          # POSTGRES_PASSWORD=your-password

# 3. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# 4. è®¿é—®ç³»ç»Ÿ
# å‰ç«¯ç•Œé¢:    http://localhost
# API æ–‡æ¡£:   http://localhost:8000/docs
```

### æ–¹å¼ä¸‰ï¼šæœ¬åœ°å¼€å‘æ¨¡å¼ï¼ˆä¸ä½¿ç”¨ Dockerï¼‰

```bash
# çŽ¯å¢ƒè¦æ±‚ï¼šPython 3.11+ã€Node.js 20+ã€PostgreSQL 15+ã€Redis 7+

# 1. å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# 2. é…ç½®çŽ¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env è®¾ç½®æ•°æ®åº“è¿žæŽ¥ä¿¡æ¯

# 3. åˆå§‹åŒ–æ•°æ®åº“ï¼ˆåˆ›å»ºè¡¨ + é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼‰
cd backend && python ../scripts/init_db.py

# 4. å¯¼å…¥çŸ¥è¯†åº“æ–‡æ¡£
mkdir -p data/knowledge
# å°† PDF/DOCX/TXT/MD æ–‡æ¡£æ”¾å…¥ data/knowledge/
python scripts/load_knowledge.py --dir data/knowledge

# 5. å¯åŠ¨åŽç«¯
cd backend
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# 6. å¯åŠ¨å‰ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
cd frontend
npm install && npm run dev
# è®¿é—® http://localhost:5173
```

### é»˜è®¤è´¦å·

| è´¦å· | å¯†ç  | è§’è‰² |
|------|------|------|
| admin | Admin@123456 | ç®¡ç†å‘˜ |

> âš ï¸ é¦–æ¬¡ç™»å½•åŽè¯·ç«‹å³ä¿®æ”¹å¯†ç 

---

## ðŸ“¡ API æŽ¥å£æ‘˜è¦

| æ–¹æ³• | è·¯å¾„ | æè¿° | è®¤è¯ |
|------|------|------|------|
| POST | `/auth/register` | ç”¨æˆ·æ³¨å†Œ | âŒ |
| POST | `/auth/login` | ç”¨æˆ·ç™»å½• | âŒ |
| GET  | `/auth/me` | å½“å‰ç”¨æˆ·ä¿¡æ¯ | âœ… |
| POST | `/chat/message` | å‘é€æ¶ˆæ¯ï¼ˆRESTï¼‰ | å¯é€‰ |
| GET  | `/chat/history/{session_id}` | å¯¹è¯åŽ†å² | âœ… |
| POST | `/chat/end/{session_id}` | ç»“æŸä¼šè¯ | âœ… |
| POST | `/chat/feedback` | æ¶ˆæ¯è¯„åˆ† | âœ… |
| WS   | `/ws/chat/{session_id}` | WebSocket æµå¼å¯¹è¯ | âœ… |
| POST | `/knowledge/upload` | ä¸Šä¼ çŸ¥è¯†æ–‡æ¡£ | agent+ |
| GET  | `/knowledge/list` | æ–‡æ¡£åˆ—è¡¨ | agent+ |
| DELETE | `/knowledge/{id}` | åˆ é™¤æ–‡æ¡£ | admin |
| POST | `/knowledge/search` | è¯­ä¹‰æœç´¢ | âœ… |
| GET  | `/admin/stats` | ç³»ç»Ÿç»Ÿè®¡ | admin |
| GET  | `/admin/conversations` | å¯¹è¯åˆ—è¡¨ | admin |
| GET  | `/admin/users` | ç”¨æˆ·åˆ—è¡¨ | admin |
| GET  | `/health` | å¥åº·æ£€æŸ¥ | âŒ |

ðŸ“– å®Œæ•´æŽ¥å£æ–‡æ¡£è§ [docs/api.md](docs/api.md) æˆ–è®¿é—® `http://localhost:8000/docs`

---

## âš™ï¸ ä¸»è¦çŽ¯å¢ƒå˜é‡

| å˜é‡ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜Ž |
|------|------|--------|------|
| `LLM_PROVIDER` | âŒ | `ollama` | `openai` / `ollama` / `azure_openai` |
| `OLLAMA_BASE_URL` | Ollamaå¿…å¡« | `http://host.docker.internal:11434` | Dockerå†…è®¿é—®å®¿ä¸»æœºOllama |
| `OLLAMA_MODEL` | âŒ | `qwen2.5:7b` | Ollama èŠå¤©æ¨¡åž‹å |
| `OPENAI_API_KEY` | OpenAIå¿…å¡« | - | OpenAI API å¯†é’¥ |
| `POSTGRES_PASSWORD` | âœ… | - | PostgreSQL å¯†ç  |
| `DATABASE_URL` | âœ… | - | PostgreSQL è¿žæŽ¥ä¸² |
| `REDIS_URL` | âŒ | `redis://redis:6379/0` | Redis è¿žæŽ¥ä¸² |
| `SECRET_KEY` | âœ… | - | JWT ç­¾åå¯†é’¥ï¼ˆç”Ÿäº§å¿…é¡»ä¿®æ”¹ï¼‰ |

---

## ðŸ”‘ æ ¸å¿ƒç‰¹æ€§

- âœ… **å¤šè½®å¯¹è¯** â€” Redis æ»‘åŠ¨çª—å£ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œæ”¯æŒ N è½®è®°å¿†
- âœ… **RAG æ£€ç´¢å¢žå¼º** â€” ChromaDB å‘é‡æ£€ç´¢ + å¤šçº§ç¼“å­˜ï¼ˆL1 å†…å­˜ + L2 Redisï¼‰
- âœ… **æ„å›¾è¯†åˆ«** â€” è§„åˆ™ä¼˜å…ˆ + LLM å…œåº•ï¼Œè‡ªåŠ¨è¯†åˆ« 6 ç±»ç”¨æˆ·æ„å›¾
- âœ… **æµå¼è¾“å‡º** â€” WebSocket å®žæ—¶ Token æµå¼ä¼ è¾“ï¼Œæ¯«ç§’çº§é¦–å­—èŠ‚å“åº”
- âœ… **å¤šæ¨¡åž‹æ”¯æŒ** â€” OpenAI / Ollamaï¼ˆæœ¬åœ°éƒ¨ç½²ï¼‰/ Azure OpenAI æ— ç¼åˆ‡æ¢
- âœ… **JWT è®¤è¯** â€” Access Tokenï¼ˆ1hï¼‰+ Refresh Tokenï¼ˆ7dï¼‰ï¼Œç™»å½•é”å®šä¿æŠ¤
- âœ… **æ€§èƒ½ä¼˜åŒ–** â€” Embedding æ‰¹é‡ç¼“å­˜ï¼ˆTTL 24hï¼‰ã€çƒ­ç‚¹çŸ¥è¯†é¢„çƒ­ã€DB è¿žæŽ¥æ± 
- âœ… **ç»“æž„åŒ–æ—¥å¿—** â€” request_id ä¼ æ’­ã€LLM è°ƒç”¨è¿½è¸ªã€JSON Lines å®¡è®¡æ—¥å¿—
- âœ… **è´¨é‡ç›‘æŽ§** â€” P95 å»¶è¿Ÿã€RAG å‘½ä¸­çŽ‡ã€æ„å›¾åˆ†å¸ƒã€ç”¨æˆ·æ»¡æ„åº¦æŒ‡æ ‡
- âœ… **å®¹å™¨åŒ–éƒ¨ç½²** â€” å¤šé˜¶æ®µ Dockerfileã€Nginx åå‘ä»£ç†ã€Docker Compose ç¼–æŽ’

---

## ðŸŽ“ æ¨¡åž‹è®­ç»ƒä¸Žå¾®è°ƒ

> å¯¹äºŽå¤§å¤šæ•°å®¢æœåœºæ™¯ï¼ŒæŽ¨èå…ˆé€šè¿‡**å……å®žçŸ¥è¯†åº“ + è°ƒä¼˜ Prompt** æå‡æ•ˆæžœï¼Œå†è€ƒè™‘å¾®è°ƒã€‚

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | æˆæœ¬ | æ•ˆæžœæå‡ | éš¾åº¦ |
|------|------|----------|------|
| ä¸Šä¼ çŸ¥è¯†åº“æ–‡æ¡£ï¼ˆRAGï¼‰ | å…è´¹ | â­â­â­ | ä½Ž |
| è°ƒä¼˜ç³»ç»Ÿ Prompt | å…è´¹ | â­â­ | ä½Ž |
| LoRA å¾®è°ƒ | éœ€è¦ GPU | â­â­â­â­ | ä¸­ |
| å…¨é‡å¾®è°ƒ / é¢„è®­ç»ƒ | éœ€è¦å¤šå¡ | â­â­â­â­â­ | é«˜ |

---

### æ–¹æ¡ˆä¸€ï¼šå……å®žçŸ¥è¯†åº“ï¼ˆæ— éœ€è®­ç»ƒï¼ŒæŽ¨èä¼˜å…ˆå°è¯•ï¼‰

å°†ä¸šåŠ¡æ–‡æ¡£æ”¾å…¥çŸ¥è¯†åº“ï¼Œæ¨¡åž‹ä¼šè‡ªåŠ¨æ£€ç´¢åŽå›žç­”ï¼š

```bash
# æ”¯æŒæ ¼å¼ï¼šPDFã€DOCXã€TXTã€MD
mkdir -p data/knowledge
cp your-docs/*.pdf data/knowledge/

# æ‰¹é‡å¯¼å…¥
python scripts/load_knowledge.py --dir data/knowledge

# æˆ–é€šè¿‡å‰ç«¯ç•Œé¢ä¸Šä¼ ï¼ˆç®¡ç†å‘˜è´¦å·ç™»å½•åŽæ“ä½œï¼‰
```

---

### æ–¹æ¡ˆäºŒï¼šè°ƒä¼˜ç³»ç»Ÿ Prompt

ä¿®æ”¹ [backend/core/llm/prompt_manager.py](backend/core/llm/prompt_manager.py) ä¸­çš„ç³»ç»Ÿæç¤ºè¯ï¼Œè®©æ¨¡åž‹æ›´è´´åˆä½ çš„ä¸šåŠ¡åœºæ™¯ï¼š

```python
SYSTEM_PROMPT = """ä½ æ˜¯XXå…¬å¸çš„æ™ºèƒ½å®¢æœåŠ©æ‰‹ï¼Œä¸“æ³¨äºŽå¤„ç†å”®åŽã€é€€æ¬¾ã€ç‰©æµç­‰é—®é¢˜ã€‚
å›žç­”é£Žæ ¼ï¼šç®€æ´ã€ç¤¼è²Œã€ä¸“ä¸šã€‚
å½“æ— æ³•å›žç­”æ—¶ï¼Œå¼•å¯¼ç”¨æˆ·è”ç³»äººå·¥å®¢æœï¼š400-xxx-xxxxã€‚"""
```

---

### æ–¹æ¡ˆä¸‰ï¼šLoRA å¾®è°ƒ qwen2.5:7b

ä½¿ç”¨è‡ªå·±çš„å¯¹è¯æ•°æ®å¯¹æ¨¡åž‹è¿›è¡Œå¾®è°ƒï¼Œæ•ˆæžœæœ€å¥½ã€‚

#### ç¡¬ä»¶è¦æ±‚
| æ–¹æ³• | æ˜¾å­˜éœ€æ±‚ | è¯´æ˜Ž |
|------|----------|------|
| QLoRAï¼ˆ4-bit é‡åŒ–ï¼‰ | 10~16 GB | RTX 3080/4070/3090 å¯ç”¨ |
| LoRAï¼ˆbf16ï¼‰ | 24 GB+ | RTX 4090 / A100 |
| CPU è®­ç»ƒ | æ—  GPU è¦æ±‚ | æžæ…¢ï¼Œä¸æŽ¨è |

#### 1. å‡†å¤‡è®­ç»ƒæ•°æ®

åˆ›å»º `data/finetune/train.json`ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```json
[
  {
    "instruction": "ä½ æ˜¯ä¸€åä¸“ä¸šå®¢æœï¼Œè¯·å›žç­”ç”¨æˆ·é—®é¢˜",
    "input": "æˆ‘çš„è®¢å•è¿˜æ²¡åˆ°ï¼Œæ€Žä¹ˆæŸ¥ç‰©æµï¼Ÿ",
    "output": "æ‚¨å¥½ï¼æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥è¯¢ç‰©æµï¼š\n1. ç™»å½•å®˜ç½‘ã€Œæˆ‘çš„è®¢å•ã€é¡µé¢ç‚¹å‡»ã€ŒæŸ¥çœ‹ç‰©æµã€\n2. åœ¨å¿«é€’å…¬å¸å®˜ç½‘è¾“å…¥è¿å•å·æŸ¥è¯¢\nå¦‚æœ‰ç–‘é—®è¯·æä¾›è®¢å•å·ï¼Œæˆ‘ä¸ºæ‚¨è¿›ä¸€æ­¥æŸ¥è¯¢ã€‚"
  },
  {
    "instruction": "ä½ æ˜¯ä¸€åä¸“ä¸šå®¢æœï¼Œè¯·å›žç­”ç”¨æˆ·é—®é¢˜",
    "input": "å¦‚ä½•ç”³è¯·é€€æ¬¾ï¼Ÿ",
    "output": "é€€æ¬¾ç”³è¯·æ­¥éª¤ï¼š\n1. ç™»å½•è´¦å·è¿›å…¥ã€Œæˆ‘çš„è®¢å•ã€\n2. æ‰¾åˆ°å¯¹åº”è®¢å•ç‚¹å‡»ã€Œç”³è¯·é€€æ¬¾ã€\n3. é€‰æ‹©é€€æ¬¾åŽŸå› å¹¶æäº¤\næ”¶åˆ°ç”³è¯·åŽ1-3ä¸ªå·¥ä½œæ—¥å†…å®¡æ ¸ï¼Œé€€æ¬¾å°†åŽŸè·¯è¿”å›žã€‚"
  }
]
```

æ•°æ®é‡å»ºè®®ï¼š**300æ¡ä»¥ä¸Š**æ•ˆæžœæ˜Žæ˜¾ï¼Œ1000æ¡ä»¥ä¸Šæ•ˆæžœç¨³å®šã€‚

#### 2. ä½¿ç”¨ LLaMA-Factory å¾®è°ƒ

```bash
# å®‰è£… LLaMA-Factory
git clone https://github.com/hiyouga/LLaMA-Factory.git
cd LLaMA-Factory
pip install -e ".[torch,metrics]"

# å¯åŠ¨ Web UIï¼ˆæŽ¨èï¼Œå¯è§†åŒ–é…ç½®è®­ç»ƒå‚æ•°ï¼‰
llamafactory-cli webui

# æˆ–ç›´æŽ¥å‘½ä»¤è¡Œè®­ç»ƒï¼ˆQLoRAï¼Œé€‚åˆæ¶ˆè´¹çº§ GPUï¼‰
llamafactory-cli train \
  --model_name_or_path Qwen/Qwen2.5-7B-Instruct \
  --method lora \
  --quantization_bit 4 \
  --dataset your_dataset \
  --template qwen \
  --output_dir ./output/qwen2.5-7b-customer-service \
  --num_train_epochs 3 \
  --per_device_train_batch_size 2 \
  --gradient_accumulation_steps 4 \
  --learning_rate 1e-4 \
  --fp16
```

#### 3. å¯¼å‡ºå¹¶åŠ è½½åˆ° Ollama

```bash
# åˆå¹¶ LoRA æƒé‡å¹¶å¯¼å‡ºä¸º GGUF æ ¼å¼
llamafactory-cli export \
  --model_name_or_path Qwen/Qwen2.5-7B-Instruct \
  --adapter_name_or_path ./output/qwen2.5-7b-customer-service \
  --template qwen \
  --export_dir ./output/merged \
  --export_quantization_bit 4

# è½¬æ¢ä¸º GGUFï¼ˆéœ€è¦ llama.cppï¼‰
git clone https://github.com/ggerganov/llama.cpp && cd llama.cpp
python convert_hf_to_gguf.py ../output/merged --outfile qwen2.5-cs.gguf --outtype q4_k_m

# åˆ›å»º Ollama æ¨¡åž‹
cat > Modelfile << EOF
FROM ./qwen2.5-cs.gguf
SYSTEM "ä½ æ˜¯ä¸“ä¸šçš„å®¢æœåŠ©æ‰‹ï¼Œè´Ÿè´£è§£ç­”å”®åŽã€é€€æ¬¾ã€ç‰©æµç­‰é—®é¢˜ã€‚"
EOF
ollama create qwen2.5-customer-service -f Modelfile

# ä¿®æ”¹ .env ä½¿ç”¨å¾®è°ƒåŽçš„æ¨¡åž‹
# OLLAMA_MODEL=qwen2.5-customer-service
```

---

## ðŸ§ª è¿è¡Œæµ‹è¯•

```bash
cd backend
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-asyncio httpx

# è¿è¡Œå…¨éƒ¨æµ‹è¯•
pytest ../tests/ -v

# ä»…è¿è¡Œå•å…ƒæµ‹è¯•
pytest ../tests/unit/ -v

# ä»…è¿è¡Œé›†æˆæµ‹è¯•
pytest ../tests/integration/ -v

# ç”Ÿæˆè¦†ç›–çŽ‡æŠ¥å‘Š
pytest ../tests/ --cov=. --cov-report=html
```

---

## ðŸ“„ License

MIT

